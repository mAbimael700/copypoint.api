name: Deploy to Coolify

on:
  push:
    branches: [main]  # Cambia si usas otra rama para producci√≥n

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Set up Java
        uses: actions/setup-java@v3
        with:
          java-version: '21'
          distribution: 'temurin'

      - name: Build with Maven
        run: mvn clean package -DskipTests

      - name: Trigger redeploy in Coolify
        run: |
          echo "Redeploying service in Coolify..."
          curl -X POST \
            -H "Authorization: Bearer ${{ secrets.COOLIFY_API_KEY }}" \
            -H "Content-Type: application/json" \
            http://${{ secrets.COOLIFY_HOST }}/api/v1/services/${{ secrets.COOLIFY_SERVICE_UUID }}/redeploy
